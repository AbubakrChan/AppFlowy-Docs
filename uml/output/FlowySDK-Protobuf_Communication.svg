<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="762px" preserveAspectRatio="none" style="width:696px;height:762px;background:#FFFFFF;" version="1.1" viewBox="0 0 696 762" width="696px" zoomAndPan="magnify"><defs/><g><rect height="26.4883" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="192" x="245" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="182" x="250" y="23.5352">Protobuf Communication</text><g id="cluster_##792"><rect height="712.5" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:1.0;fill:none;" width="683" x="7" y="44.4883"/></g><!--MD5=[b24267d2964530fde97dbe32f532d632]
cluster frontend (Flutter)--><g id="cluster_frontend (Flutter)"><path d="M391.5,68.4883 L528.5,68.4883 A3.75,3.75 0 0 1 531,70.9883 L538,90.9766 L663.5,90.9766 A2.5,2.5 0 0 1 666,93.4766 L666,306.4883 A2.5,2.5 0 0 1 663.5,308.9883 L391.5,308.9883 A2.5,2.5 0 0 1 389,306.4883 L389,70.9883 A2.5,2.5 0 0 1 391.5,68.4883 " fill="#DDDDDD" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="389" x2="538" y1="90.9766" y2="90.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="136" x="393" y="84.0234">frontend (Flutter)</text></g><!--MD5=[dda78dbc42a958268ede67472bfec7a7]
cluster Backend (Rust)--><g id="cluster_Backend (Rust)"><path d="M377.5,357.9883 L494.5,357.9883 A3.75,3.75 0 0 1 497,360.4883 L504,380.4766 L663.5,380.4766 A2.5,2.5 0 0 1 666,382.9766 L666,726.4883 A2.5,2.5 0 0 1 663.5,728.9883 L377.5,728.9883 A2.5,2.5 0 0 1 375,726.4883 L375,360.4883 A2.5,2.5 0 0 1 377.5,357.9883 " fill="#DDDDDD" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="375" x2="504" y1="380.4766" y2="380.4766"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="116" x="379" y="373.5234">Backend (Rust)</text></g><g id="elem_GMN797"><path d="M23.5,82.9883 L23.5,169.541 A0,0 0 0 0 23.5,169.541 L370.5,169.541 A0,0 0 0 0 370.5,169.541 L370.5,130.4883 L405.26,126.4883 L370.5,122.4883 L370.5,92.9883 L360.5,82.9883 L23.5,82.9883 A0,0 0 0 0 23.5,82.9883 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M360.5,82.9883 L360.5,92.9883 L370.5,92.9883 L360.5,82.9883 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="29.5" y="100.5566">class FolderEventExportDocument {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="310" x="45.5" y="115.8672">Future&lt;Either&lt;ExportData, FlowyError&gt;&gt; send() {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="61.5" y="131.1777">...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="45.5" y="146.4883">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="29.5" y="161.7988">}</text></g><g id="elem_GMN804"><path d="M65.5,638.9883 L65.5,740.8516 A0,0 0 0 0 65.5,740.8516 L356.5,740.8516 A0,0 0 0 0 356.5,740.8516 L356.5,693.9883 L391.5,689.9883 L356.5,685.9883 L356.5,648.9883 L346.5,638.9883 L65.5,638.9883 A0,0 0 0 0 65.5,638.9883 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M346.5,638.9883 L346.5,648.9883 L356.5,648.9883 L346.5,638.9883 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="71.5" y="656.5566">pub(crate) async fn export_handler(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="87.5" y="671.8672">data: Data&lt;ExportPayload&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="252" x="87.5" y="687.1777">controller: Unit&lt;Arc&lt;ViewController&gt;&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="270" x="71.5" y="702.4883">) -&gt; DataResult&lt;ExportData, FlowyError&gt; {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="87.5" y="717.7988">...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="71.5" y="733.1094">}</text></g><!--MD5=[4e260e4024c27e03c495c33059d2b5ff]
entity Repository--><g id="elem_Repository"><rect fill="#F1F1F1" height="46.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="113" x="405.5" y="103.4883"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="498.5" y="108.4883"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="496.5" y="110.4883"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="496.5" y="114.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="420.5" y="137.0234">Repository</text></g><!--MD5=[78e0d1133500ea5a75200a919f68dfaf]
entity FFI_Frontend--><g id="elem_FFI_Frontend"><rect fill="#FFDDDD" height="46.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="60" x="429" y="246.9883"/><rect fill="#FFDDDD" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="469" y="251.9883"/><rect fill="#FFDDDD" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="467" y="253.9883"/><rect fill="#FFDDDD" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="467" y="257.9883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="20" x="444" y="280.5234">FFI</text></g><!--MD5=[32a6d3b508021f5875dd65aaa7b12f72]
entity Module--><g id="elem_Module"><rect fill="#F1F1F1" height="46.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="91" x="391.5" y="666.9883"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="462.5" y="671.9883"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="460.5" y="673.9883"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="460.5" y="677.9883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="406.5" y="700.5234">Module</text></g><!--MD5=[8438b603195005c18d5011c1879083f4]
entity Dispatcher--><g id="elem_Dispatcher"><rect fill="#FFDDDD" height="46.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="113" x="394.5" y="515.9883"/><rect fill="#FFDDDD" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="487.5" y="520.9883"/><rect fill="#FFDDDD" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="485.5" y="522.9883"/><rect fill="#FFDDDD" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="485.5" y="526.9883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="409.5" y="549.5234">Dispatcher</text></g><!--MD5=[179e2604d0e0114e09ff0fc2b2cdbe9a]
entity FFI_Backend--><g id="elem_FFI_Backend"><rect fill="#FFDDDD" height="46.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="60" x="422" y="392.9883"/><rect fill="#FFDDDD" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="462" y="397.9883"/><rect fill="#FFDDDD" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="460" y="399.9883"/><rect fill="#FFDDDD" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="460" y="403.9883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="20" x="437" y="426.5234">FFI</text></g><!--MD5=[a2160a1f3fca2f537bfc003f6f9e328a]
link Repository to Repository--><g id="link_Repository_Repository"><path d="M518.74,111.1183 C538.01,111.0383 553.5,116.1583 553.5,126.4883 C553.5,135.8483 540.78,140.9383 524.05,141.7483 " fill="none" id="Repository-to-Repository" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="518.74,141.8583,527.8291,145.6516,523.7387,141.744,527.6462,137.6537,518.74,141.8583" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="559.5" y="131.5566">1.ExportPayload</text></g><!--MD5=[38d973180e405282d57257eaaecfdf7c]
link Repository to FFI_Frontend--><g id="link_Repository_FFI_Frontend"><path d="M461.53,149.5983 C461.01,174.3783 460.15,214.5783 459.59,241.3883 " fill="none" id="Repository-to-FFI_Frontend" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="459.48,246.5683,463.6846,237.662,459.5943,241.5696,455.6867,237.4792,459.48,246.5683" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="461" y="213.5566">2. Event + ExportPayload</text></g><!--MD5=[4de8113ca68441e6ab054604d393395d]
link FFI_Frontend to FFI_Backend--><g id="link_FFI_Frontend_FFI_Backend"><path d="M457.92,293.1683 C456.69,318.4683 454.68,359.8483 453.35,387.2583 " fill="none" id="FFI_Frontend-to-FFI_Backend" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="453.09,392.5383,457.5231,383.7436,453.3333,387.5442,449.5326,383.3543,453.09,392.5383" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="45" x="457" y="338.5566">3.Bytes</text></g><!--MD5=[4995e94678fa022b3b0236d8d155fc5d]
link FFI_Backend to Dispatcher--><g id="link_FFI_Backend_Dispatcher"><path d="M451.82,439.1783 C451.65,459.3983 451.4,489.2983 451.22,510.9083 " fill="none" id="FFI_Backend-to-Dispatcher" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="451.18,515.9383,455.257,506.9729,451.2229,510.9385,447.2573,506.9043,451.18,515.9383" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="452" y="482.5566">4: Event + ExportPayload</text></g><!--MD5=[b7fb86ef4098194ef634f4b8ec52f618]
link Dispatcher to Module--><g id="link_Dispatcher_Module"><path d="M448.9,562.2983 C446.42,588.7383 442.28,632.8083 439.59,661.3783 " fill="none" id="Dispatcher-to-Module" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="439.11,666.5283,443.9418,657.9461,439.582,661.5506,435.9775,657.1909,439.11,666.5283" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="447" y="605.5566">5.ExportPayload</text></g><!--MD5=[99490c0f37cc8245679cd82b45289fb2]
link Module to Module--><g id="link_Module_Module"><path d="M482.52,673.6383 C501.45,672.5083 517.5,677.9583 517.5,689.9883 C517.5,700.8883 504.32,706.3883 487.75,706.4883 " fill="none" id="Module-to-Module" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="482.52,706.3383,491.4142,710.5683,487.5183,706.4668,491.6198,702.571,482.52,706.3383" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="523.5" y="695.0566">6. call export_handler</text></g><!--MD5=[47c1e5cdbb60b99dafba787e276cf500]
@startuml FlowySDK
title Protobuf Communication
top to bottom direction
'skinparam linetype polyline

rectangle {
    package "frontend (Flutter)" #DDDDDD {
        component Repository
        component FFI_Frontend as "FFI" #FFDDDD
    }
    note left of Repository
    class FolderEventExportDocument {
        Future<Either<ExportData, FlowyError>> send() {
            ...
        }
    }
    end note

    package "Backend (Rust)" #DDDDDD {
        component Module
        component Dispatcher as "Dispatcher" #FFDDDD
        component FFI_Backend as "FFI" #FFDDDD
    }
    note left of Module
    pub(crate) async fn export_handler(
        data: Data<ExportPayload>,
        controller: Unit<Arc<ViewController>>,
    ) -> DataResult<ExportData, FlowyError> {
        ...
    }
    end note
}

Repository - -> Repository: 1.ExportPayload
Repository - -> FFI_Frontend: 2. Event + ExportPayload
FFI_Frontend - -> FFI_Backend: 3.Bytes
FFI_Backend - -> Dispatcher: 4: Event + ExportPayload
Dispatcher - -> Module: 5.ExportPayload
Module - -> Module : 6. call export_handler
@enduml

@startuml FlowySDK
title Protobuf Communication
top to bottom direction

rectangle {
    package "frontend (Flutter)" #DDDDDD {
        component Repository
        component FFI_Frontend as "FFI" #FFDDDD
    }
    note left of Repository
    class FolderEventExportDocument {
        Future<Either<ExportData, FlowyError>> send() {
            ...
        }
    }
    end note

    package "Backend (Rust)" #DDDDDD {
        component Module
        component Dispatcher as "Dispatcher" #FFDDDD
        component FFI_Backend as "FFI" #FFDDDD
    }
    note left of Module
    pub(crate) async fn export_handler(
        data: Data<ExportPayload>,
        controller: Unit<Arc<ViewController>>,
    ) -> DataResult<ExportData, FlowyError> {
        ...
    }
    end note
}

Repository - -> Repository: 1.ExportPayload
Repository - -> FFI_Frontend: 2. Event + ExportPayload
FFI_Frontend - -> FFI_Backend: 3.Bytes
FFI_Backend - -> Dispatcher: 4: Event + ExportPayload
Dispatcher - -> Module: 5.ExportPayload
Module - -> Module : 6. call export_handler
@enduml

PlantUML version 1.2022.5(Sat Apr 30 18:55:52 CST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>