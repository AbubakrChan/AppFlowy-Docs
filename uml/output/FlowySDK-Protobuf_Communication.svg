<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="752px" preserveAspectRatio="none" style="width:704px;height:752px;background:#FFFFFF;" version="1.1" viewBox="0 0 704 752" width="704px" zoomAndPan="magnify"><defs><filter height="300%" id="fjkcag96zgina" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="218" x="236.5" y="17.4023">Protobuf Communication</text><rect fill="#FFFFFF" filter="url(#fjkcag96zgina)" height="712.5" style="stroke:#000000;stroke-width:1.5;" width="685" x="7" y="28.1992"/><!--MD5=[b24267d2964530fde97dbe32f532d632]
cluster Front-end (Flutter)--><polygon fill="#DDDDDD" filter="url(#fjkcag96zgina)" points="389,52.1992,531,52.1992,538,74.6875,668,74.6875,668,292.6992,389,292.6992,389,52.1992" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="389" x2="538" y1="74.6875" y2="74.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="136" x="393" y="67.7344">Front-end (Flutter)</text><!--MD5=[dda78dbc42a958268ede67472bfec7a7]
cluster Back-end (Rust)--><polygon fill="#DDDDDD" filter="url(#fjkcag96zgina)" points="377,341.6992,499,341.6992,506,364.1875,668,364.1875,668,712.6992,377,712.6992,377,341.6992" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="377" x2="506" y1="364.1875" y2="364.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="116" x="381" y="357.2344">Back-end (Rust)</text><path d="M23.5,66.6992 L23.5,153.252 A0,0 0 0 0 23.5,153.252 L370.5,153.252 A0,0 0 0 0 370.5,153.252 L370.5,114.1992 L405.26,110.1992 L370.5,106.1992 L370.5,76.6992 L360.5,66.6992 L23.5,66.6992 A0,0 0 0 0 23.5,66.6992 " fill="#FBFB77" filter="url(#fjkcag96zgina)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M360.5,66.6992 L360.5,76.6992 L370.5,76.6992 L360.5,66.6992 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="29.5" y="84.2676">class FolderEventExportDocument {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="310" x="45.5" y="99.5781">Future&lt;Either&lt;ExportData, FlowyError&gt;&gt; send() {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="61.5" y="114.8887">...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="45.5" y="130.1992">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="29.5" y="145.5098">}</text><path d="M67.5,622.6992 L67.5,724.5625 A0,0 0 0 0 67.5,724.5625 L358.5,724.5625 A0,0 0 0 0 358.5,724.5625 L358.5,677.6992 L393.5,673.6992 L358.5,669.6992 L358.5,632.6992 L348.5,622.6992 L67.5,622.6992 A0,0 0 0 0 67.5,622.6992 " fill="#FBFB77" filter="url(#fjkcag96zgina)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M348.5,622.6992 L348.5,632.6992 L358.5,632.6992 L348.5,622.6992 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="73.5" y="640.2676">pub(crate) async fn export_handler(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="89.5" y="655.5781">data: Data&lt;ExportRequest&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="252" x="89.5" y="670.8887">controller: Unit&lt;Arc&lt;ViewController&gt;&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="270" x="73.5" y="686.1992">) -&gt; DataResult&lt;ExportData, FlowyError&gt; {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="89.5" y="701.5098">...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="73.5" y="716.8203">}</text><!--MD5=[4e260e4024c27e03c495c33059d2b5ff]
entity Repository--><rect fill="#FEFECE" filter="url(#fjkcag96zgina)" height="46.4883" style="stroke:#A80036;stroke-width:1.5;" width="113" x="405.5" y="87.1992"/><rect fill="#FEFECE" height="10" style="stroke:#A80036;stroke-width:1.5;" width="15" x="498.5" y="92.1992"/><rect fill="#FEFECE" height="2" style="stroke:#A80036;stroke-width:1.5;" width="4" x="496.5" y="94.1992"/><rect fill="#FEFECE" height="2" style="stroke:#A80036;stroke-width:1.5;" width="4" x="496.5" y="98.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="420.5" y="120.7344">Repository</text><!--MD5=[78e0d1133500ea5a75200a919f68dfaf]
entity FFI_Frontend--><rect fill="#FFDDDD" filter="url(#fjkcag96zgina)" height="46.4883" style="stroke:#A80036;stroke-width:1.5;" width="60" x="430" y="230.6992"/><rect fill="#FFDDDD" height="10" style="stroke:#A80036;stroke-width:1.5;" width="15" x="470" y="235.6992"/><rect fill="#FFDDDD" height="2" style="stroke:#A80036;stroke-width:1.5;" width="4" x="468" y="237.6992"/><rect fill="#FFDDDD" height="2" style="stroke:#A80036;stroke-width:1.5;" width="4" x="468" y="241.6992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="20" x="445" y="264.2344">FFI</text><!--MD5=[32a6d3b508021f5875dd65aaa7b12f72]
entity Module--><rect fill="#FEFECE" filter="url(#fjkcag96zgina)" height="46.4883" style="stroke:#A80036;stroke-width:1.5;" width="91" x="393.5" y="650.6992"/><rect fill="#FEFECE" height="10" style="stroke:#A80036;stroke-width:1.5;" width="15" x="464.5" y="655.6992"/><rect fill="#FEFECE" height="2" style="stroke:#A80036;stroke-width:1.5;" width="4" x="462.5" y="657.6992"/><rect fill="#FEFECE" height="2" style="stroke:#A80036;stroke-width:1.5;" width="4" x="462.5" y="661.6992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="408.5" y="684.2344">Module</text><!--MD5=[8438b603195005c18d5011c1879083f4]
entity Dispatcher--><rect fill="#FFDDDD" filter="url(#fjkcag96zgina)" height="46.4883" style="stroke:#A80036;stroke-width:1.5;" width="113" x="396.5" y="499.6992"/><rect fill="#FFDDDD" height="10" style="stroke:#A80036;stroke-width:1.5;" width="15" x="489.5" y="504.6992"/><rect fill="#FFDDDD" height="2" style="stroke:#A80036;stroke-width:1.5;" width="4" x="487.5" y="506.6992"/><rect fill="#FFDDDD" height="2" style="stroke:#A80036;stroke-width:1.5;" width="4" x="487.5" y="510.6992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="411.5" y="533.2344">Dispatcher</text><!--MD5=[179e2604d0e0114e09ff0fc2b2cdbe9a]
entity FFI_Backend--><rect fill="#FFDDDD" filter="url(#fjkcag96zgina)" height="46.4883" style="stroke:#A80036;stroke-width:1.5;" width="60" x="424" y="376.6992"/><rect fill="#FFDDDD" height="10" style="stroke:#A80036;stroke-width:1.5;" width="15" x="464" y="381.6992"/><rect fill="#FFDDDD" height="2" style="stroke:#A80036;stroke-width:1.5;" width="4" x="462" y="383.6992"/><rect fill="#FFDDDD" height="2" style="stroke:#A80036;stroke-width:1.5;" width="4" x="462" y="387.6992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="20" x="439" y="410.2344">FFI</text><!--MD5=[a2160a1f3fca2f537bfc003f6f9e328a]
link Repository to Repository--><path d="M518.74,94.8292 C538.01,94.7492 553.5,99.8692 553.5,110.1992 C553.5,119.5592 540.78,124.6492 524.05,125.4592 " fill="none" id="Repository-to-Repository" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="518.74,125.5692,527.8291,129.3625,523.7387,125.455,527.6462,121.3646,518.74,125.5692" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="559.5" y="115.2676">1.ExportRequest</text><!--MD5=[38d973180e405282d57257eaaecfdf7c]
link Repository to FFI_Frontend--><path d="M461.69,133.3092 C461.34,158.0892 460.77,198.2892 460.39,225.0992 " fill="none" id="Repository-to-FFI_Frontend" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="460.32,230.2792,464.4482,221.3373,460.3914,225.2797,456.449,221.223,460.32,230.2792" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="461" y="197.2676">2. Event + ExportRequest</text><!--MD5=[4de8113ca68441e6ab054604d393395d]
link FFI_Frontend to FFI_Backend--><path d="M459.08,276.8792 C458.02,302.1792 456.3,343.5592 455.16,370.9692 " fill="none" id="FFI_Frontend-to-FFI_Backend" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="454.94,376.2492,459.3228,367.4293,455.1547,371.2538,451.3302,367.0858,454.94,376.2492" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="45" x="458" y="322.2676">3.Bytes</text><!--MD5=[4995e94678fa022b3b0236d8d155fc5d]
link FFI_Backend to Dispatcher--><path d="M453.82,422.8892 C453.65,443.1092 453.4,473.0092 453.22,494.6192 " fill="none" id="FFI_Backend-to-Dispatcher" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="453.18,499.6492,457.257,490.6838,453.2229,494.6494,449.2573,490.6153,453.18,499.6492" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="454" y="466.2676">4: Event + ExportRequest</text><!--MD5=[b7fb86ef4098194ef634f4b8ec52f618]
link Dispatcher to Module--><path d="M450.9,546.0092 C448.42,572.4492 444.28,616.5192 441.59,645.0892 " fill="none" id="Dispatcher-to-Module" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="441.11,650.2392,445.9418,641.657,441.582,645.2615,437.9775,640.9018,441.11,650.2392" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="449" y="589.2676">5.ExportRequest</text><!--MD5=[99490c0f37cc8245679cd82b45289fb2]
link Module to Module--><path d="M484.52,657.3492 C503.45,656.2192 519.5,661.6692 519.5,673.6992 C519.5,684.5992 506.32,690.0992 489.75,690.1992 " fill="none" id="Module-to-Module" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="484.52,690.0492,493.4142,694.2792,489.5183,690.1777,493.6198,686.2819,484.52,690.0492" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="525.5" y="678.7676">6. call export_handler</text><!--MD5=[ad729d37cd06cacbec96ad54f3f75ab3]
@startuml FlowySDK
title Protobuf Communication
top to bottom direction
'skinparam linetype polyline

rectangle {
    package "Front-end (Flutter)" #DDDDDD {
        component Repository
        component FFI_Frontend as "FFI" #FFDDDD
    }
    note left of Repository
    class FolderEventExportDocument {
        Future<Either<ExportData, FlowyError>> send() {
            ...
        }
    }
    end note

    package "Back-end (Rust)" #DDDDDD {
        component Module
        component Dispatcher as "Dispatcher" #FFDDDD
        component FFI_Backend as "FFI" #FFDDDD
    }
    note left of Module
    pub(crate) async fn export_handler(
        data: Data<ExportRequest>,
        controller: Unit<Arc<ViewController>>,
    ) -> DataResult<ExportData, FlowyError> {
        ...
    }
    end note
}

Repository - -> Repository: 1.ExportRequest
Repository - -> FFI_Frontend: 2. Event + ExportRequest
FFI_Frontend - -> FFI_Backend: 3.Bytes
FFI_Backend - -> Dispatcher: 4: Event + ExportRequest
Dispatcher - -> Module: 5.ExportRequest
Module - -> Module : 6. call export_handler
@enduml

@startuml FlowySDK
title Protobuf Communication
top to bottom direction

rectangle {
    package "Front-end (Flutter)" #DDDDDD {
        component Repository
        component FFI_Frontend as "FFI" #FFDDDD
    }
    note left of Repository
    class FolderEventExportDocument {
        Future<Either<ExportData, FlowyError>> send() {
            ...
        }
    }
    end note

    package "Back-end (Rust)" #DDDDDD {
        component Module
        component Dispatcher as "Dispatcher" #FFDDDD
        component FFI_Backend as "FFI" #FFDDDD
    }
    note left of Module
    pub(crate) async fn export_handler(
        data: Data<ExportRequest>,
        controller: Unit<Arc<ViewController>>,
    ) -> DataResult<ExportData, FlowyError> {
        ...
    }
    end note
}

Repository - -> Repository: 1.ExportRequest
Repository - -> FFI_Frontend: 2. Event + ExportRequest
FFI_Frontend - -> FFI_Backend: 3.Bytes
FFI_Backend - -> Dispatcher: 4: Event + ExportRequest
Dispatcher - -> Module: 5.ExportRequest
Module - -> Module : 6. call export_handler
@enduml

PlantUML version 1.2022.0(Wed Jan 12 00:16:42 CST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>